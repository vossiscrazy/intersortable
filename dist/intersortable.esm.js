var I=!1,c=null,u=null,b={x:0,y:0},y={x:0,y:0},T=null,g="above",p=null,L="above",d={};function v(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function E(e){let t=e.getBoundingClientRect();return{x:t.left+t.width/2,y:t.top+t.height/2}}function O(e,t,r,n,o){e.removeAttribute("data-intersortable-item"),e.style.position="fixed",e.style.pointerEvents="none",e.style.zIndex="9999",e.style.opacity="1",e.style.left=r-o.x+"px",e.style.top=n-o.y+"px",e.style.transform="scale(1.05)",e.style.boxShadow="0 10px 25px rgba(0, 0, 0, 0.3)",e.style.width=t.offsetWidth+"px",e.style.height=t.offsetHeight+"px"}function N(){I=!1,document.body.style.cursor="auto",T=null,p=null,L="above",document.querySelectorAll("[data-intersortable-item]").forEach(t=>{setTimeout(()=>{t.style.transition="",t.style.transform=""},250)})}function B(e,t,r){let n=[];document.querySelectorAll("[data-intersortable-item]").forEach(a=>{a!==e&&n.push({element:a,rect:a.getBoundingClientRect()})});let l=e.getBoundingClientRect();if(e.parentNode&&e.parentNode.removeChild(e),t.hasAttribute("data-intersortable-container"))t.appendChild(e);else{let a=t.parentNode;if(!a)return;if(r==="above")a.insertBefore(e,t);else{let f=t.nextSibling;f?a.insertBefore(e,f):a.appendChild(e)}}let i=e.getBoundingClientRect(),s=l.left-i.left,m=l.top-i.top;(Math.abs(s)>1||Math.abs(m)>1)&&(e.style.transform=`translate(${s}px, ${m}px)`,e.style.transition="none",requestAnimationFrame(()=>{e.style.transition="transform 0.2s ease-out",e.style.transform="translate(0, 0)"})),n.forEach(({element:a,rect:f})=>{let M=a.getBoundingClientRect(),H=f.left-M.left,x=f.top-M.top;(Math.abs(H)>1||Math.abs(x)>1)&&(a.style.transform=`translate(${H}px, ${x}px)`,a.style.transition="none",requestAnimationFrame(()=>{a.style.transition="transform 0.15s ease-out",a.style.transform="translate(0, 0)"}))})}function w(){u&&(y=E(u));let e=document.querySelectorAll("[data-intersortable-item]"),t=null,r=1/0;e.forEach(l=>{let i=E(l),s=v(i,y);s<r&&(r=s,t=l)}),document.querySelectorAll("[data-intersortable-container]").forEach(l=>{if(l.querySelectorAll("[data-intersortable-item]").length===0){let s=E(l),m=v(s,y);m<r&&(r=m,t=l)}});let o=t;if(T=o,o)if(o===c)g="above";else{let l=E(o);g=y.y<=l.y?"above":"below"}if(o&&c&&o!==c&&(o!==p||g!==L)){let l=(d.getContainerId||h)(c);if(B(c,o,g),d.onMove){let i=(d.getItemId||C)(c),s=(d.getContainerId||h)(c),m=S(),a=m[s]?.indexOf(i)??-1;i&&l&&s&&d.onMove({itemId:i,fromContainer:l,toContainer:s,newIndex:a,allContainers:m})}p=o,L=g}}function C(e){return e.dataset.itemId||e.id||""}function h(e){let t=e.closest("[data-intersortable-container]");return t?.dataset.containerId||t?.id||""}function S(){let e=document.querySelectorAll("[data-intersortable-container]"),t={};return e.forEach(r=>{let n=(d.getContainerId||h)(r);if(n){let o=r.querySelectorAll("[data-intersortable-item]");t[n]=Array.from(o).map(l=>(d.getItemId||C)(l)).filter(l=>l)}}),t}function D(e={}){d={...e},document.addEventListener("mousedown",R),document.addEventListener("mousemove",q),document.addEventListener("mouseup",A)}function R(e){let t=e.target,r=null,n=null;if(t.closest("[data-drag-handle]"))r=t.closest("[data-drag-handle]"),n=r.closest("[data-intersortable-item]");else if(n=t.closest("[data-intersortable-item]"),n){if(n.querySelector("[data-drag-handle]"))return;r=n}if(n&&r){I=!0,c=n,p=null,L="above";let o=n.getBoundingClientRect();b.x=e.clientX-o.left,b.y=e.clientY-o.top,u=n.cloneNode(!0),O(u,n,e.clientX,e.clientY,b),document.body.appendChild(u),w(),n.style.opacity="0.4",document.body.style.cursor="grabbing",e.preventDefault()}}function q(e){if(I&&u){let t=e.clientX-b.x,r=e.clientY-b.y;u.style.left=t+"px",u.style.top=r+"px",w()}}function A(e){if(I){if(d.onComplete){let t=S();d.onComplete(t)}u&&(document.body.removeChild(u),u=null),c&&(c.style.opacity="1",c=null),N()}}function X(e){Object.entries(e).forEach(([t,r])=>{let n=document.querySelector(`[data-container-id="${t}"], #${t}`);if(!n)return;let o=new Map;n.querySelectorAll("[data-intersortable-item]").forEach(i=>{let s=(d.getItemId||C)(i);s&&o.set(s,i)}),r.forEach(i=>{let s=o.get(i);s&&n.appendChild(s)})})}function Y(){document.removeEventListener("mousedown",R),document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",A)}export{Y as cleanupSortable,D as initSortable,X as restoreSortOrder};
