"use strict";class c{constructor(t){this.dragState={isDragging:!1,originalItem:null,cloneItem:null,startX:0,startY:0,nearestItem:null,lastTargetedElement:null,ghostItems:[],animatingElements:new Set},this.callbacks={},t&&(this.callbacks=t),this.init()}init(){document.addEventListener("mousedown",this.handleMouseDown.bind(this)),document.addEventListener("mousemove",this.handleMouseMove.bind(this)),document.addEventListener("mouseup",this.handleMouseUp.bind(this))}handleMouseDown(t){const i=t.target.closest("[data-intersortable-item-id]");i&&(t.preventDefault(),this.dragState.isDragging=!0,this.dragState.originalItem=i,this.dragState.startX=t.clientX,this.dragState.startY=t.clientY,i.style.opacity="0.4",this.createClone(i,t.clientX,t.clientY),this.initializeTargetingSystem(),this.callbacks.onPickup&&this.callbacks.onPickup(this.getCurrentState()))}createClone(t,n,i){const e=t.cloneNode(!0),a=t.getBoundingClientRect();e.style.position="fixed",e.style.left=`${a.left}px`,e.style.top=`${a.top}px`,e.style.width=`${a.width}px`,e.style.height=`${a.height}px`,e.style.transform="scale(1.05)",e.style.transformOrigin="center",e.style.pointerEvents="none",e.style.zIndex="1000",e.style.opacity="1",e.classList.add("intersortable-drag-clone"),e.removeAttribute("data-intersortable-item-id"),document.body.appendChild(e),this.dragState.cloneItem=e}handleMouseMove(t){if(!this.dragState.isDragging||!this.dragState.cloneItem)return;const n=t.clientX-this.dragState.startX,i=t.clientY-this.dragState.startY,e=this.dragState.cloneItem.getBoundingClientRect(),a=parseFloat(this.dragState.cloneItem.style.left),r=parseFloat(this.dragState.cloneItem.style.top);this.dragState.cloneItem.style.left=`${a+n}px`,this.dragState.cloneItem.style.top=`${r+i}px`,this.dragState.startX=t.clientX,this.dragState.startY=t.clientY,this.updateTargetingSystem()}handleMouseUp(t){this.dragState.isDragging&&(this.dragState.originalItem&&(this.dragState.originalItem.style.opacity=""),this.dragState.cloneItem&&document.body.removeChild(this.dragState.cloneItem),this.cleanupTargetingSystem(),this.cleanupGhostItems(),this.callbacks.onDrop&&this.callbacks.onDrop(this.getCurrentState()),this.dragState={isDragging:!1,originalItem:null,cloneItem:null,startX:0,startY:0,nearestItem:null,lastTargetedElement:null,ghostItems:[],animatingElements:new Set})}initializeTargetingSystem(){document.querySelectorAll("[data-intersortable-container-id]").forEach(n=>{if(n.querySelectorAll("[data-intersortable-item-id]").length===0){const e=this.createGhostItem();n.appendChild(e),this.dragState.ghostItems.push(e)}}),this.updateTargetingSystem()}createGhostItem(){const t=document.createElement("div");return t.className="bg-neutral-700 rounded px-3 py-2 text-neutral-300 text-sm",t.setAttribute("data-intersortable-item-id",`ghost-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),t.textContent="\u{1F47B} Drop here",t.style.opacity="0",t.style.pointerEvents="none",t}updateTargetingSystem(){if(!this.dragState.cloneItem)return;const t=this.dragState.cloneItem.getBoundingClientRect(),n=t.left+t.width/2,i=t.top+t.height/2;let e=1/0,a=null;document.querySelectorAll("[data-intersortable-item-id]").forEach(s=>{const o=s.getBoundingClientRect(),l=o.left+o.width/2,d=o.top+o.height/2,g=Math.sqrt(Math.pow(n-l,2)+Math.pow(i-d,2));g<e&&(e=g,a=s)}),a&&(this.dragState.nearestItem=a,this.moveOriginalItem())}moveOriginalItem(){if(!this.dragState.originalItem||!this.dragState.nearestItem||!this.dragState.cloneItem)return;const t=this.dragState.nearestItem,n=this.dragState.originalItem,i=t.getAttribute("data-intersortable-item-id")?.startsWith("ghost-");let e=!1,a=null,r=null;if(i){const s=t.parentNode;s&&n.parentNode!==s&&(a=s,r=t,e=!0)}else{const s=this.dragState.cloneItem.getBoundingClientRect(),o=t.getBoundingClientRect(),l=s.top+s.height/2,d=o.top+o.height/2;l<d?n.nextElementSibling!==t&&(a=t.parentNode,r=t,e=!0):n.previousElementSibling!==t&&(a=t.parentNode,r=t.nextSibling,e=!0)}e&&a&&r!==void 0&&this.performFLIPAnimation(a,r),e&&this.recreateTargetingSystem()}performFLIPAnimation(t,n){const i=document.querySelectorAll("[data-intersortable-item-id]"),e=new Map;i.forEach(a=>{e.set(a,a.getBoundingClientRect())}),n?t.insertBefore(this.dragState.originalItem,n):t.appendChild(this.dragState.originalItem),i.forEach(a=>{const r=e.get(a);if(!r)return;const s=a.getBoundingClientRect(),o=r.left-s.left,l=r.top-s.top;(Math.abs(o)>.5||Math.abs(l)>.5)&&this.animateElement(a,o,l)})}animateElement(t,n,i){this.dragState.animatingElements.add(t),t.animate([{transform:`translate(${n}px, ${i}px)`},{transform:"translate(0, 0)"}],{duration:300,easing:"ease-out"}).addEventListener("finish",()=>{this.dragState.animatingElements.delete(t)})}recreateTargetingSystem(){document.querySelectorAll("[data-intersortable-container-id]").forEach(n=>{if(n.querySelectorAll("[data-intersortable-item-id]").length===0){const e=this.createGhostItem();n.appendChild(e),this.dragState.ghostItems.push(e)}})}cleanupTargetingSystem(){this.dragState.nearestItem=null,this.dragState.lastTargetedElement=null}cleanupGhostItems(){this.dragState.ghostItems.forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)}),this.dragState.ghostItems=[]}getCurrentState(){const t={};return document.querySelectorAll("[data-intersortable-container-id]").forEach(i=>{const e=i.getAttribute("data-intersortable-container-id"),a=i.querySelectorAll("[data-intersortable-item-id]"),r=Array.from(a).filter(s=>!((s.getAttribute("data-intersortable-item-id")||"").startsWith("ghost-")||this.dragState.ghostItems.includes(s)));t[e]=r.map((s,o)=>({id:s.getAttribute("data-intersortable-item-id")||"",text:s.textContent||"",position:o}))}),t}static init(t){return new c(t)}}export default c;
//# sourceMappingURL=intersortable.min.js.map
